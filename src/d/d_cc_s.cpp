//
// Generated by dtk
// Translation Unit: d_cc_s.cpp
//

#include "d/d_cc_s.h"
#include "d/d_cc_d.h"
#include "d/d_com_inf_game.h"

/* 800AD5B0-800AD5E4       .text Ct__4dCcSFv */
void dCcS::Ct() {
    cCcS::Ct();
    mMass_Mng.Ct();
}

/* 800AD5E4-800AD604       .text Dt__4dCcSFv */
void dCcS::Dt() {
    cCcS::Dt();
}

/* 800AD604-800AD748       .text ChkShieldFrontRange__4dCcSFP8cCcD_ObjP8cCcD_Obj */
bool dCcS::ChkShieldFrontRange(cCcD_Obj* obj1, cCcD_Obj* obj2) {
    dCcD_GObjInf* inf1 = (dCcD_GObjInf*)obj1->GetGObjInf();
    if (inf1 == NULL) { return false; }
    dCcD_Stts* stts1 = (dCcD_Stts*)inf1->GetStts();
    fopAc_ac_c* ac1 = stts1 == NULL ? NULL : stts1->GetAc();
    if (ac1 == NULL) { return false; }
    dCcD_GObjInf* inf2 = (dCcD_GObjInf*)obj2->GetGObjInf();
    if (inf2 == NULL) { return false; }
    dCcD_Stts* stts2 = (dCcD_Stts*)inf2->GetStts();
    fopAc_ac_c* ac2 = stts2 == NULL ? NULL : stts2->GetAc();
    if (ac2 == NULL) { return false; }
    
    cXyz delta;
    VECSubtract(&ac1->mEyePos, &ac2->mEyePos, &delta);
    f32 dist = PSVECMag(&delta);
    if (cM3d_IsZero(dist)) {
        return false;
    }
    PSVECNormalize(&delta, &delta);
    s16 deltaAngle = cM_atan2s(delta.x, delta.z);
    s16 shieldAngle = inf2->GetTgShieldFrontRangeYAngle() ? *inf2->GetTgShieldFrontRangeYAngle() : ac2->shape_angle.y;
    if (cLib_distanceAngleS(deltaAngle, shieldAngle) > 0x4000) {
        return false;
    }
    
    return true;
}

/* 800AD748-800AD7D0       .text ChkShield__4dCcSFP8cCcD_ObjP8cCcD_ObjP12dCcD_GObjInfP12dCcD_GObjInf */
bool dCcS::ChkShield(cCcD_Obj* obj1, cCcD_Obj* obj2, dCcD_GObjInf* inf1, dCcD_GObjInf* inf2) {
    if (inf1->ChkAtNoGuard()) {
        return false;
    }
    if (inf2->ChkTgShield()) {
        if (inf2->ChkTgShieldFrontRange()) {
            return ChkShieldFrontRange(obj1, obj2);
        } else {
            return true;
        }
    } else {
        return false;
    }
}

/* 800AD7D0-800AD86C       .text CalcTgPlusDmg__4dCcSFP8cCcD_ObjP8cCcD_ObjP9cCcD_SttsP9cCcD_Stts */
void dCcS::CalcTgPlusDmg(cCcD_Obj* obj1, cCcD_Obj* obj2, cCcD_Stts* stts1, cCcD_Stts* stts2) {
    dCcD_GObjInf* inf1 = (dCcD_GObjInf*)obj1->GetGObjInf();
    dCcD_GObjInf* inf2 = (dCcD_GObjInf*)obj2->GetGObjInf();
    if (!ChkShield(obj1, obj2, inf1, inf2)) {
        int atp = obj1->GetAtAtp();
        if (stts2->GetDmg() < atp) {
            stts2->PlusDmg(atp);
        }
    }
}

/* 800AD86C-800AD8EC       .text ChkAtTgHitAfterCross__4dCcSFbbPC12cCcD_GObjInfPC12cCcD_GObjInfP9cCcD_SttsP9cCcD_SttsP10cCcD_GSttsP10cCcD_GStts */
bool dCcS::ChkAtTgHitAfterCross(bool r4, bool r5, const cCcD_GObjInf* r6, const cCcD_GObjInf* r7,
                                cCcD_Stts* r8, cCcD_Stts* r9, cCcD_GStts* r10, cCcD_GStts* sp8) {
    dCcD_GStts* r10_d = (dCcD_GStts*)r10;
    dCcD_GStts* r9_d = (dCcD_GStts*)r9;
    dCcD_GStts* r8_d = (dCcD_GStts*)r8;
    dCcD_GStts* sp8_d = (dCcD_GStts*)sp8;
    dCcD_GObjInf* r6_d = (dCcD_GObjInf*)r6;
    dCcD_GObjInf* r7_d = (dCcD_GObjInf*)r7;
    unsigned int r11 = r8->GetApid();
    unsigned int r3 = r9->GetApid();
    if (r4) {
        r10_d->SetAtApid(r3);
        if (r6_d->ChkAtNoConHit() && r10_d->GetAtOldApid() == r9_d->GetAtOldApid()) {
            return true;
        }
    }
    if (r5) {
        sp8_d->SetTgApid(r11);
        if (r7_d->ChkTgNoConHit() && !r6_d->ChkAtStopNoConHit() && sp8_d->GetTgOldApid() == r8_d->GetAtOldApid()) {
            return true;
        }
    }
    return false;
}

/* 800AD8EC-800ADA30       .text SetCoGObjInf__4dCcSFbbP12cCcD_GObjInfP12cCcD_GObjInfP9cCcD_SttsP9cCcD_SttsP10cCcD_GSttsP10cCcD_GStts */
void dCcS::SetCoGObjInf(bool, bool, cCcD_GObjInf*, cCcD_GObjInf*, cCcD_Stts*, cCcD_Stts*, cCcD_GStts*, cCcD_GStts*) {
    /* Nonmatching */
}

static u8 rank_tbl[11][11] = {
    { 0, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100 },
    { 0,  50, 100, 100, 100, 100, 100, 100, 100, 100, 100 },
    { 0,   0,  50,  75,  90, 100, 100, 100, 100, 100, 100 },
    { 0,   0,  25,  50,  75,  90, 100, 100, 100, 100, 100 },
    { 0,   0,  10,  25,  50,  75,  90, 100, 100, 100, 100 },
    { 0,   0,   0,  10,  25,  50,  75,  90, 100, 100, 100 },
    { 0,   0,   0,   0,  10,  25,  50,  75,  90, 100, 100 },
    { 0,   0,   0,   0,   0,  10,  25,  50,  75, 100, 100 },
    { 0,   0,   0,   0,   0,   0,  10,  25,  50, 100, 100 },
    { 0,   0,   0,   0,   0,   0,   0,   0,   0,  50, 100 },
    { 0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0 },
};

/* 800ADA30-800ADAD4       .text GetRank__4dCcSFUc */
int dCcS::GetRank(u8 weight) {
    if (weight == 0xFF) {
        return 10;
    } else if (weight == 0xFE) {
        return 9;
    } else if (weight >= 0xD9) {
        return 8;
    } else if (weight >= 0xB5) {
        return 7;
    } else if (weight >= 0x91) {
        return 6;
    } else if (weight >= 0x6D) {
        return 5;
    } else if (weight >= 0x49) {
        return 4;
    } else if (weight >= 0x25) {
        return 3;
    } else if (weight >= 0x02) {
        return 2;
    } else if (weight == 0x01) {
        return 1;
    } else {
        return 0;
    }
}

/* 800ADAD4-800ADEF0       .text SetPosCorrect__4dCcSFP8cCcD_ObjP4cXyzP8cCcD_ObjP4cXyzf */
void dCcS::SetPosCorrect(cCcD_Obj*, cXyz*, cCcD_Obj*, cXyz*, f32) {
    /* Nonmatching */
}

/* 800ADEF0-800ADFF8       .text CalcParticleAngle__4dCcSFP12dCcD_GObjInfP9cCcD_SttsP9cCcD_SttsP5csXyz */
void dCcS::CalcParticleAngle(dCcD_GObjInf*, cCcD_Stts*, cCcD_Stts*, csXyz*) {
    /* Nonmatching */
}

/* 800ADFF8-800AE308       .text ProcAtTgHitmark__4dCcSFbbP8cCcD_ObjP8cCcD_ObjP12dCcD_GObjInfP12dCcD_GObjInfP9cCcD_SttsP9cCcD_SttsP10dCcD_GSttsP10dCcD_GSttsP4cXyz */
void dCcS::ProcAtTgHitmark(bool, bool, cCcD_Obj* r6, cCcD_Obj* r7, dCcD_GObjInf* atInf, dCcD_GObjInf* tgInf,
                           cCcD_Stts* r10, cCcD_Stts* r30, dCcD_GStts*, dCcD_GStts* r4, cXyz* pos)
{
    if (atInf->ChkAtNoHitMark()) { return; }
    if (tgInf->ChkTgNoHitMark()) { return; }
    if (tgInf->GetTgHitMark() == 0xFF) { return; }
    if (!r4->ChkNoneActorPerfTblId()) { return; }
    
    if (!ChkShield(r6, r7, atInf, tgInf)) {
        if (atInf->GetAtHitMark() == 0) { return; }
        if (atInf->GetAtHitMark() == 1 && tgInf->GetTgHitMark() == 1) {
            dComIfGp_particle_set(dPa_name::ID_COMMON_STARS_BLOW, pos);
        } else {
            csXyz angle;
            CalcParticleAngle(atInf, r10, r30, &angle);
            if (atInf->GetAtHitMark() == 0xF) {
                dComIfGp_particle_set(0x10, pos);
                cXyz scale;
                scale.x = scale.y = scale.z = 2.0f;
                dComIfGp_particle_set(dPa_name::ID_COMMON_NORMAL_HIT, pos, &angle, &scale);
            } else if (atInf->GetAtHitMark() == 1) {
                dComIfGp_particle_set(dPa_name::ID_COMMON_NORMAL_HIT, pos, &angle);
            } else {
                dComIfGp_particle_set(atInf->GetAtHitMark(), pos, &angle);
            }
            dKy_SordFlush_set(*pos, 1);
        }
    } else {
        if (tgInf->GetTgHitMark() == 0) { return; }
        dKy_SordFlush_set(*pos, 0);
        csXyz angle;
        CalcParticleAngle(atInf, r10, r30, &angle);
        dComIfGp_particle_set(tgInf->GetTgHitMark(), pos, &angle);
    }
}

/* 800AE308-800AE5AC       .text SetAtTgGObjInf__4dCcSFbbP8cCcD_ObjP8cCcD_ObjP12cCcD_GObjInfP12cCcD_GObjInfP9cCcD_SttsP9cCcD_SttsP10cCcD_GSttsP10cCcD_GSttsP4cXyz */
void dCcS::SetAtTgGObjInf(bool, bool, cCcD_Obj*, cCcD_Obj*, cCcD_GObjInf*, cCcD_GObjInf*, cCcD_Stts*, cCcD_Stts*, cCcD_GStts*, cCcD_GStts*, cXyz*) {
    /* Nonmatching */
}

/* 800AE5AC-800AE814       .text ChkCamera__4dCcSFR4cXyzR4cXyzfP10fopAc_ac_cP10fopAc_ac_c */
bool dCcS::ChkCamera(cXyz&, cXyz&, f32, fopAc_ac_c*, fopAc_ac_c*) {
    /* Nonmatching */
}

/* 800AE814-800AE818       .text MoveAfterCheck__4dCcSFv */
void dCcS::MoveAfterCheck() {
    /* Nonmatching */
}

/* 800AE818-800AE81C       .text DrawAfter__4dCcSFv */
void dCcS::DrawAfter() {
    /* Nonmatching */
}

/* 800AE81C-800AE83C       .text Move__4dCcSFv */
void dCcS::Move() {
    cCcS::Move();
}

/* 800AE83C-800AE878       .text Draw__4dCcSFv */
void dCcS::Draw() {
    DrawAfter();
    DrawClear();
    mMass_Mng.Clear();
}

/* 800AE878-800AE89C       .text MassClear__4dCcSFv */
void dCcS::MassClear() {
    mMass_Mng.Clear();
}

/* 800AE89C-800AE930       .text ChkNoHitGCo__4dCcSFP8cCcD_ObjP8cCcD_Obj */
bool dCcS::ChkNoHitGCo(cCcD_Obj* obj1, cCcD_Obj* obj2) {
    dCcD_GObjInf* inf1 = (dCcD_GObjInf*)obj1->GetGObjInf();
    dCcD_GObjInf* inf2 = (dCcD_GObjInf*)obj2->GetGObjInf();
    if ((inf1->ChkCoAtLasso() && !inf2->ChkCoTgLasso()) || (inf2->ChkCoAtLasso() && !inf1->ChkCoTgLasso())) {
        return true;
    }
    return false;
}

/* 800AE930-800AE938       .text ChkNoHitGAtTg__4cCcSFPC12cCcD_GObjInfPC12cCcD_GObjInfP10cCcD_GSttsP10cCcD_GStts */
bool cCcS::ChkNoHitGAtTg(const cCcD_GObjInf*, const cCcD_GObjInf*, cCcD_GStts*, cCcD_GStts*) {
    return false;
}

