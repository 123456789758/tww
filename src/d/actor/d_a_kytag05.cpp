//
// Generated by dtk
// Translation Unit: d_a_kytag05.cpp
//
#include "JSystem/JKernel/JKRHeap.h"
#include "JAZelAudio/JAIZelBasic.h"
#include "f_op/f_op_actor_mng.h"
#include "f_op/f_op_camera_mng.h"
#include "d/d_com_inf_game.h"
#include "d/d_kankyo_wether.h"
#include "d/actor/d_a_player.h"
#include "d/actor/d_a_ykgr.h"
#include "dolphin/types.h"

class kytag05_class : public fopAc_ac_c {
public:
    /* 0x00 */ u32 field_0x290;
    /* 0x04 */ u32 field_0x294;
    /* 0x08 */ u32 field_0x298;
};

BOOL daKytag05_Draw(kytag05_class*) {
    return true;
}

/* 00000080-000003F4       .text daKytag05_Execute__FP13kytag05_class */
int daKytag05_Execute(kytag05_class* a_this) {
    /* Nonmatching */
//    static s16 wind_table[] = {
//        0, //18
//        90, //1C
//        180, //20
//        270 //24
//        };// 0x2C

    daPy_py_c *playerActor;
    camera_class *mpCamera;
    u8 bVar1;
    u32 uVar4;
    u32 iVar5;
    u32 demoField;
    float var_f1;
    float var_f30;
    float blend;

    mpCamera = dComIfGp_getCamera(0);
    playerActor = daPy_getPlayerActorClass();
    dKyw_get_wind_pow();
    var_f30 = 0;

    if (g_env_light.mWind.mEvtWindSet == 0xff) {
        return 1;
    }
    if (g_dComIfG_gameInfo.play.mEvtCtrl.mMode != 0 &&
        dComIfGp_getEventManager().startCheckOld("KYTAG05") != 0 &&
        g_dComIfG_gameInfo.play.getDemo() != NULL) {
        demoField = g_dComIfG_gameInfo.play.getDemo()->field_0xd4;
        if(demoField >= 0x186) {
            var_f1 = (demoField - 90.0f) / 180.0f;
            if(var_f1 > var_f30) {
                var_f1 = var_f30;
            }
            var_f30 = 0 - var_f1;
            g_env_light.mSnowCount = 270.0f * var_f30;
        } else if (demoField == 0x187 && daYkgr_c::m_emitter != 0) {
            daYkgr_c::m_alpha_flag = 0;
        }
    }
    dKy_custom_colset(0, 7, var_f30);
    if(a_this->field_0x290 & 1) {
        if(a_this->field_0x294 >= 0) {
            a_this->field_0x294 = 0;
            a_this->field_0x290 += 1;
            g_env_light.mWind.mEvtWindSet = 2;
        } else {
            a_this->field_0x294 += 1;
        }
    } else {
        if(a_this->field_0x294 >= 0) {
            a_this->field_0x290 += 1;
            if(a_this->field_0x290 >> 1 >= 4) {
                a_this->field_0x290 = 0;
            }
            dKyw_evt_wind_set(0, -16000);
            a_this->field_0x294 = 0;
            g_env_light.mWind.mEvtWindSet = 1;
        } else {
            a_this->field_0x294 += 1;
        }
    }
}

BOOL daKytag05_IsDelete(kytag05_class*) {
    return true;
}

BOOL daKytag05_Delete(kytag05_class*) {
    return true;
}

int daKytag05_Create(fopAc_ac_c* i_this) {
    fopAcM_SetupActor(i_this, kytag05_class);
    kytag05_class *a_this = (kytag05_class*)i_this;
    if (dComIfGs_isSymbol(1) != 0) {
        return 3;
    }
    a_this->field_0x290 = 0;
    a_this->field_0x294 = 0;
    a_this->field_0x298 = i_this->mBase.mParameters & 0xff;
    dKyw_evt_wind_set_go();
    dKyw_evt_wind_set(0,0);
    g_env_light.mSnowCount = 200;
    g_env_light.mMoyaMode = 0;
    g_env_light.mMoyaCount = 100;

    return 4;
}

