//
// Generated by dtk
// Translation Unit: d_bg_s.cpp
//

#include "d/d_bg_s.h"
#include "d/d_com_inf_game.h"
#include "f_op/f_op_actor_mng.h"

/* 800A0270-800A0290       .text Ct__4dBgSFv */
void dBgS::Ct() {
    cBgS::Ct();
}

/* 800A0290-800A02B0       .text Dt__4dBgSFv */
void dBgS::Dt() {
    cBgS::Dt();
}

/* 800A02B0-800A02E8       .text ClrMoveFlag__4dBgSFv */
void dBgS::ClrMoveFlag() {
    for (s32 i = 0; i < ARRAY_SIZE(m_chk_element); i++) {
        if (m_chk_element[i].ChkUsed()) {
            dBgW* bgwp = (dBgW*)m_chk_element[i].m_bgw_base_ptr;
            bgwp->mFlag &= ~1;
        }
    }
}

/* 800A02E8-800A0354       .text Move__4dBgSFv */
void dBgS::Move() {
    cBgS::Move();

    for (s32 i = 0; i < ARRAY_SIZE(m_chk_element); i++) {
        if (m_chk_element[i].ChkUsed()) {
            dBgW* bgwp = (dBgW*)m_chk_element[i].m_bgw_base_ptr;
            s16 shape_angle = m_chk_element[i].m_actor_ptr->shape_angle.y;
            bgwp->mRotYDelta = shape_angle - bgwp->mOldRotY;
            bgwp->mOldRotY = shape_angle;
        }
    }
}

/* 800A0354-800A03C4       .text Regist__4dBgSFP4cBgWP10fopAc_ac_c */
bool dBgS::Regist(cBgW* bgw, fopAc_ac_c* ac) {
    if (bgw == NULL)
        return true;

    if (ac != NULL && !!(bgw->mFlags & cBgW::MOVE_BG_e)) {
        dBgW* bgwp = (dBgW*)bgw;
        bgwp->mOldRotY = ac->shape_angle.y;
        bgwp->mRoomNo = fopAcM_GetRoomNo(ac);
    }

    return cBgS::Regist(bgw, fopAcM_GetID(ac), ac);
}

/* 800A03C4-800A0420       .text ChkMoveBG__4dBgSFR13cBgS_PolyInfo */
bool dBgS::ChkMoveBG(cBgS_PolyInfo& polyInfo) {
    dBgW* bgwp = (dBgW*)dComIfG_Bgsp()->GetBgWPointer(polyInfo);
    if (bgwp != NULL) {
        if (bgwp->mFlags & cBgW::LOCK_e)
            return false;
        if (bgwp->mFlags & cBgW::MOVE_BG_e)
            return true;
    }
    return false;
}

/* 800A0420-800A046C       .text ChkMoveBG_NoDABg__4dBgSFR13cBgS_PolyInfo */
bool dBgS::ChkMoveBG_NoDABg(cBgS_PolyInfo& polyInfo) {
    dBgW* bgwp = (dBgW*)dComIfG_Bgsp()->GetBgWPointer(polyInfo);
    if (bgwp != NULL) {
        if (bgwp->mFlags & cBgW::MOVE_BG_e)
            return true;
    }
    return false;
}

/* 800A046C-800A0604       .text GetPolyId0__4dBgSFiiiUlUl */
int dBgS::GetPolyId0(int bg_index, int poly_index, int defv, u32 mask, u32 shift) {
    JUT_ASSERT(0x349, 0 <= bg_index && bg_index < 256);
    if (!m_chk_element[bg_index].ChkUsed())
        return defv;

    dBgW* bgwp = (dBgW*)m_chk_element[bg_index].m_bgw_base_ptr;
    u32 inf_id = bgwp->GetPolyInfId(poly_index);
    return (bgwp->GetPolyInf0(inf_id) & mask) >> shift;
}

/* 800A0604-800A0630       .text GetPolyCamId__4dBgSFii */
int dBgS::GetPolyCamId(int i_bg_index, int i_poly_index) {
    return GetPolyId0(i_bg_index, i_poly_index, 0xFF, 0x000000FF, 0);
}

/* 800A0630-800A0668       .text GetMtrlSndId__4dBgSFR13cBgS_PolyInfo */
u32 dBgS::GetMtrlSndId(cBgS_PolyInfo& polyInfo) {
    return GetPolyId0(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0x00, 0x00001F00, 8);
}

/* 800A0668-800A06A4       .text GetExitId__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetExitId(cBgS_PolyInfo& polyInfo) {
    return GetPolyId0(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0x3F, 0x0007E000, 13);
}

/* 800A06A4-800A0708       .text GetPolyColor__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetPolyColor(cBgS_PolyInfo& polyInfo) {
    /* Nonmatching */
}

/* 800A0708-800A07F4       .text GetGrpRoomInfId__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetGrpRoomInfId(cBgS_PolyInfo& polyInfo) {
    s32 bg_index = polyInfo.GetBgIndex();
    JUT_ASSERT(0x3a9, 0 <= bg_index && bg_index < 256);
    if (!m_chk_element[bg_index].ChkUsed())
        return 0xFF;

    dBgW* bgwp = (dBgW*)m_chk_element[bg_index].m_bgw_base_ptr;
    s32 inf = bgwp->mRoomNo2;
    if (inf != 0xFF)
        return inf;

    s32 grp_id = GetTriGrp(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex());
    if (grp_id == -1)
        return 0xFF;
    return GetGrpInf(polyInfo, grp_id) & 0xFF;
}

/* 800A07F4-800A0858       .text GetGrpSoundId__4dBgSFR13cBgS_PolyInfo */
s32 dBgS::GetGrpSoundId(cBgS_PolyInfo& polyInfo) {
    s32 grp_id = GetTriGrp(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex());
    if (grp_id == -1)
        return -1;
    return (GetGrpInf(polyInfo, grp_id) >> 11) & 0xFF;
}

/* 800A0858-800A08C0       .text ChkGrpInf__4dBgSFR13cBgS_PolyInfoUl */
u32 dBgS::ChkGrpInf(cBgS_PolyInfo& polyInfo, u32 mask) {
    /* Nonmatching */
    s32 grp_id = GetTriGrp(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex());
    if (grp_id == -1)
        return 0;

    u32 inf = GetGrpInf(polyInfo, grp_id);
    return inf & mask;
}

/* 800A08C0-800A0A5C       .text GetPolyId1__4dBgSFiiiUlUl */
int dBgS::GetPolyId1(int bg_index, int poly_index, int defv, u32 mask, u32 shift) {
    JUT_ASSERT(0x414, 0 <= bg_index && bg_index < 256);
    if (!m_chk_element[bg_index].ChkUsed())
        return defv;

    dBgW* bgwp = (dBgW*)m_chk_element[bg_index].m_bgw_base_ptr;
    u32 inf_id = bgwp->GetPolyInfId(poly_index);
    return (bgwp->GetPolyInf1(inf_id) & mask) >> shift;
}

/* 800A0A5C-800A0A94       .text GetLinkNo__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetLinkNo(cBgS_PolyInfo& polyInfo) {
    return GetPolyId1(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0xFF, 0x000000FF, 0);
}

/* 800A0A94-800A0ACC       .text GetWallCode__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetWallCode(cBgS_PolyInfo& polyInfo) {
    return GetPolyId1(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0x00, 0x00000F00, 8);
}

/* 800A0ACC-800A0B08       .text GetSpecialCode__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetSpecialCode(cBgS_PolyInfo& polyInfo) {
    return GetPolyId1(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0x00, 0x0000F000, 12);
}

/* 800A0B08-800A0B28       .text dBgS_ChangeAttributeCode__FUlPUl */
void dBgS_ChangeAttributeCode(u32, u32*) {
    /* Nonmatching */
}

/* 800A0B28-800A0B60       .text GetAttributeCodeDirect__4dBgSFR13cBgS_PolyInfo */
s32 dBgS::GetAttributeCodeDirect(cBgS_PolyInfo& polyInfo) {
    return GetPolyId1(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0x00, 0x001F0000, 16);
}

static s32 atr_conv[0x20] = {
    /* 0x00 */ dBgS_Attr_NORMAL_e,
    /* 0x01 */ dBgS_Attr_DIRT_e,
    /* 0x02 */ dBgS_Attr_WOOD_e,
    /* 0x03 */ dBgS_Attr_STONE_e,
    /* 0x04 */ dBgS_Attr_GRASS_e,
    /* 0x05 */ dBgS_Attr_GIANT_FLOWER_e,
    /* 0x06 */ dBgS_Attr_LAVA_e,
    /* 0x07 */ dBgS_Attr_DIRT_e,
    /* 0x08 */ dBgS_Attr_VOID_e,
    /* 0x09 */ dBgS_Attr_DAMAGE_e,
    /* 0x0A */ dBgS_Attr_CARPET_e,
    /* 0x0B */ dBgS_Attr_SAND_e,
    /* 0x0C */ dBgS_Attr_WOOD_e,
    /* 0x0D */ dBgS_Attr_WOOD_e,
    /* 0x0E */ dBgS_Attr_WOOD_e,
    /* 0x0F */ dBgS_Attr_ICE_e,
    /* 0x10 */ dBgS_Attr_WOOD_e,
    /* 0x11 */ dBgS_Attr_METAL_e,
    /* 0x12 */ dBgS_Attr_DIRT_e,
    /* 0x13 */ dBgS_Attr_WATER_e,
    /* 0x14 */ dBgS_Attr_METAL_e,
    /* 0x15 */ dBgS_Attr_FREEZE_e,
    /* 0x16 */ dBgS_Attr_ELECTRICITY_e,
    /* 0x17 */ dBgS_Attr_WATERFALL_e,
    /* 0x18 */ dBgS_Attr_METAL_e,
    /* 0x19 */ dBgS_Attr_CARPET_e,
    /* 0x1A */ dBgS_Attr_WOOD_e,
    /* 0x1B */ dBgS_Attr_NORMAL_e,
    /* 0x1C */ dBgS_Attr_NORMAL_e,
    /* 0x1D */ dBgS_Attr_NORMAL_e,
    /* 0x1E */ dBgS_Attr_NORMAL_e,
    /* 0x1F */ dBgS_Attr_NORMAL_e,
};

/* 800A0B60-800A0BA8       .text GetAttributeCode__4dBgSFR13cBgS_PolyInfo */
s32 dBgS::GetAttributeCode(cBgS_PolyInfo& polyInfo) {
    s32 attr = GetAttributeCodeDirect(polyInfo);
    if (attr < 0 || attr >= (int)ARRAY_SIZE(atr_conv))
        return 0;
    return atr_conv[attr];
}

/* 800A0BA8-800A0BE0       .text GetGroundCode__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetGroundCode(cBgS_PolyInfo& polyInfo) {
    return GetPolyId1(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0x00, 0x03E00000, 21);
}

/* 800A0BE0-800A0D7C       .text GetPolyId2__4dBgSFiiiUlUl */
int dBgS::GetPolyId2(int bg_index, int poly_index, int defv, u32 mask, u32 shift) {
    JUT_ASSERT(0x4c1, 0 <= bg_index && bg_index < 256);
    if (!m_chk_element[bg_index].ChkUsed())
        return defv;

    dBgW* bgwp = (dBgW*)m_chk_element[bg_index].m_bgw_base_ptr;
    u32 inf_id = bgwp->GetPolyInfId(poly_index);
    return (bgwp->GetPolyInf2(inf_id) & mask) >> shift;
}

/* 800A0D7C-800A0DB4       .text GetCamMoveBG__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetCamMoveBG(cBgS_PolyInfo& polyInfo) {
    return GetPolyId2(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0xFF, 0x000000FF, 0);
}

/* 800A0DB4-800A0DF0       .text GetRoomCamId__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetRoomCamId(cBgS_PolyInfo& polyInfo) {
    return GetPolyId2(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0xFF, 0x0000FF00, 8);
}

/* 800A0DF0-800A0E28       .text GetRoomPathId__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetRoomPathId(cBgS_PolyInfo& polyInfo) {
    return GetPolyId2(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0xFF, 0x00FF0000, 16);
}

/* 800A0E28-800A0E30       .text dBgS_GetRoomPathPntNo__FUl */
u32 dBgS_GetRoomPathPntNo(u32 param) {
    return param >> 24;
}

/* 800A0E30-800A0E68       .text GetRoomPathPntNo__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetRoomPathPntNo(cBgS_PolyInfo& polyInfo) {
    return GetPolyId2(polyInfo.GetBgIndex(), polyInfo.GetPolyIndex(), 0xFF, 0xFF000000, 24);
}

/* 800A0E68-800A0F88       .text GetRoomId__4dBgSFR13cBgS_PolyInfo */
int dBgS::GetRoomId(cBgS_PolyInfo&) {
    /* Nonmatching */
}

/* 800A0F88-800A111C       .text ChkPolyHSStick__4dBgSFR13cBgS_PolyInfo */
u32 dBgS::ChkPolyHSStick(cBgS_PolyInfo&) {
    /* Nonmatching */
}

/* 800A111C-800A12A4       .text LineCrossNonMoveBG__4dBgSFP11cBgS_LinChk */
void dBgS::LineCrossNonMoveBG(cBgS_LinChk*) {
    /* Nonmatching */
}

/* 800A12A4-800A13E0       .text WallCorrect__4dBgSFP9dBgS_Acch */
void dBgS::WallCorrect(dBgS_Acch*) {
    /* Nonmatching */
}

/* 800A13E0-800A14FC       .text RoofChk__4dBgSFP12dBgS_RoofChk */
f32 dBgS::RoofChk(dBgS_RoofChk*) {
    /* Nonmatching */
}

/* 800A14FC-800A160C       .text SplGrpChk__4dBgSFP14dBgS_SplGrpChk */
bool dBgS::SplGrpChk(dBgS_SplGrpChk*) {
    /* Nonmatching */
}

/* 800A160C-800A1730       .text SphChk__4dBgSFP11dBgS_SphChkPv */
bool dBgS::SphChk(dBgS_SphChk*, void*) {
    /* Nonmatching */
}

/* 800A1730-800A1954       .text WallCrrPos__4dBgSFP11dBgS_CrrPos */
void dBgS::WallCrrPos(dBgS_CrrPos*) {
    /* Nonmatching */
}

/* 800A1954-800A1A74       .text MoveBgCrrPos__4dBgSFR13cBgS_PolyInfobP4cXyzP5csXyzP5csXyz */
void dBgS::MoveBgCrrPos(cBgS_PolyInfo&, bool, cXyz*, csXyz*, csXyz*) {
    /* Nonmatching */
}

/* 800A1A74-800A1B94       .text MoveBgTransPos__4dBgSFR13cBgS_PolyInfobP4cXyzP5csXyzP5csXyz */
void dBgS::MoveBgTransPos(cBgS_PolyInfo&, bool, cXyz*, csXyz*, csXyz*) {
    /* Nonmatching */
}

/* 800A1B94-800A1C98       .text MoveBgMatrixCrrPos__4dBgSFR13cBgS_PolyInfobP4cXyzP5csXyzP5csXyz */
void dBgS::MoveBgMatrixCrrPos(cBgS_PolyInfo&, bool, cXyz*, csXyz*, csXyz*) {
    /* Nonmatching */
}

/* 800A1C98-800A1D18       .text dBgS_MoveBGProc_Typical__FP4dBgWPvR13cBgS_PolyInfobP4cXyzP5csXyzP5csXyz */
void dBgS_MoveBGProc_Typical(dBgW*, void*, cBgS_PolyInfo&, bool, cXyz*, csXyz*, csXyz*) {
    /* Nonmatching */
}

/* 800A1D18-800A1D4C       .text dBgS_MoveBGProc_RotY__FP4dBgWPvR13cBgS_PolyInfobP4cXyzP5csXyzP5csXyz */
void dBgS_MoveBGProc_RotY(dBgW*, void*, cBgS_PolyInfo&, bool, cXyz*, csXyz*, csXyz*) {
    /* Nonmatching */
}

/* 800A1D4C-800A1DB8       .text dBgS_MoveBGProc_TypicalRotY__FP4dBgWPvR13cBgS_PolyInfobP4cXyzP5csXyzP5csXyz */
void dBgS_MoveBGProc_TypicalRotY(dBgW*, void*, cBgS_PolyInfo&, bool, cXyz*, csXyz*, csXyz*) {
    /* Nonmatching */
}

/* 800A1DB8-800A1DF8       .text dBgS_MoveBGProc_Trans__FP4dBgWPvR13cBgS_PolyInfobP4cXyzP5csXyzP5csXyz */
void dBgS_MoveBGProc_Trans(dBgW*, void*, cBgS_PolyInfo&, bool, cXyz*, csXyz*, csXyz*) {
    /* Nonmatching */
}

/* 800A1DF8-800A1ED0       .text RideCallBack__4dBgSFR13cBgS_PolyInfoP10fopAc_ac_c */
void dBgS::RideCallBack(cBgS_PolyInfo&, fopAc_ac_c*) {
    /* Nonmatching */
}

/* 800A1ED0-800A1FD8       .text PushPullCallBack__4dBgSFR13cBgS_PolyInfoP10fopAc_ac_csQ24dBgW13PushPullLabel */
void dBgS::PushPullCallBack(cBgS_PolyInfo&, fopAc_ac_c*, short, dBgW::PushPullLabel) {
    /* Nonmatching */
}

/* 800A1FD8-800A2550       .text CrrPos__11dBgS_CrrPosFR4dBgS */
void dBgS_CrrPos::CrrPos(dBgS&) {
    /* Nonmatching */
}

/* 800A2550-800A257C       .text MatrixCrrPos__4dBgWFR13cBgS_PolyInfoPvbP4cXyzP5csXyzP5csXyz */
void dBgW::MatrixCrrPos(cBgS_PolyInfo&, void*, bool, cXyz*, csXyz*, csXyz*) {
    /* Nonmatching */
}

